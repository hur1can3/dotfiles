#!/bin/bash
# filename update_id3
for file in *.mpg3; do
if test "$file" "==" "*.mpg3"; then
        exit 0;
fi
info=${file%.mpg3}
artist=$(echo $info | cut -d';' -f1)
song=$(echo $info | cut -d';' -f2)
album=$(echo $info | cut -d';' -f3)
length=$(echo $info | cut -d';' -f4)
length=`expr $length "/" 1000`
seconds=`mp3info -p "%S" "$file"`
seconds=`expr $seconds + 4`
if test $seconds -gt $length; then
        id3v2 -a "$artist" -t "$song" -A "$album" "$file";
        album=`echo "$album" | sed "s/[^A-Za-z0-9_-]/_/g"`
        song=`echo "$song" | sed "s/[^A-Za-z0-9_-]/_/g"`
        artist=`echo "$artist" | sed "s/[^A-Za-z0-9_-]/_/g"`
        mv "$file" "$artist#$song#$album.mp3" 
else
        echo "Remove $song from $artist because file length $seconds and id length $length"
        rm "$file";
fi
done

