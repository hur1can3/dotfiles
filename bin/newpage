#!/bin/bash
#
# pbrisbin 2009, 2010
#
###

. /home/patrick/.bin/siteutils

message() { echo "usage: newpage [name]"; exit 1; }

[ $(id -u) -ne 0 ] && errorout 'you must be root'

[ -z "$1" ] && message
name="$(basename "$1")"

# add html if needed
case "$name" in
  *.html) page="$pages/$name"      ;;
  *)      page="$pages/$name.html" ;;
esac

[ -e "$page" ] && errorout "page $page already exists"

logger "new: $page..."
sleep 1

write_page_template "$page" || errorout "could not write $page"

check_md5 set "$page"

${EDITOR:-vim} "$page"

if check_md5 get "$page"; then
  echo "aborted unmodified page $page."
  rm "$page"
  exit
fi

echo -n "update RSS? " && read A
[ "$A" = 'y' ] && updaterss

echo -n "update Content? " && read A
[ "$A" = 'y' ] && mklistpage
