#!/bin/bash
#
# pbrisbin 2009
#
# http://pbrisbin.com:8080/bin/mpdparser
#
# parses an mpd db into more usable output
# one line per file with | as field separator
#
# too bad mpd-git seems to have removed file:
# from the db entries
#
###

DB="$HOME/.mpd/mpd.db"

PARSER='BEGIN { RS="key:"; FS="\n"; OFS="|" } { 

  i=0; while (i++<=NF) { 

    if ($i ~ /^file:/  ) { file=substr($i,7)   };
    if ($i ~ /^Track:/ ) { track=substr($i,8)  }; 
    if ($i ~ /^Title:/ ) { title=substr($i,8)  }; 
    if ($i ~ /^Artist:/) { artist=substr($i,9) }; 
    if ($i ~ /^Album:/ ) { album=substr($i,8)  }; 

  }; 

  if (file) { print file, track, title, artist, album }; 

};'

awk "$PARSER" "$DB"
